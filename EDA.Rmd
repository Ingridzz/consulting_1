---
title: "Group 2's Consulting Report"
author: "Kuangyou Chen, Yanbing Chen, Rose Determan, and Biyao Zhang"
output:
  pdf_document: default
---
# Introduction
Razan came to us with questions about her study of the impact of exercise on brain activation. She had three main questions.   
\newline
1. Are there differences in brain region activation before and after the exercise intervention?  
2. Is there a correlation between fitness and brain region activation?  
3. Are there differences between the control group and the treatment group? 
\newline
Due to participant drop-out, there were 15 individuals in the study. This small sample size is a limitation, since many statistical tests would lack sufficient power to confidently make conclusions. If, for example, we ran an ANOVA test, we would risk having either a type I or type II error where we reject a hypothesis that is the true 
hypothesis. Below, we have completed an exploratory data analysis (EDA) with several figures that illustrate the data, but we do  not make conclusions about relationships between variables. 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE,warning = FALSE, message = FALSE)
pacman::p_load("tidyverse", "readxl", "esquisse","GGally","ggpubr","magrittr")

#esquisser(data = df0, viewer = "browser")
```
```{r Select relevant columns and tidy data}

text_size <- 15

#import data
df0 <- read_excel("master-beta-extract_Razan.xlsx")
names(df0)[9] <- 'change_vo2'

#The last seven columns include differences pre/post. 
df <- df0%>% select('subj':'post-rh-Hippocampus_rs')

#column that start with pre and post can be made into a single column, so then 
#in visualization we can "facet" by brain region
df <- df %>%
#pivot pre-region
 pivot_longer(
   cols = starts_with("pre-"),
   names_to = "pre_region",
   values_to = "pre_active"
 ) %>%
#pivot post-region
 pivot_longer(
   cols = starts_with("post-"),
   names_to = "post_region",
   values_to = "post_active"
 )


#separate pre/post column names into brain regions, so we can keep only rows
#where the brain regions match

#format pre-region column
df <-  
  separate(df,
  "pre_region",
  into = c('extra', 'pre_region'),
  sep = 4,
  remove = TRUE
) 

#format post region column 
df <-   separate(
  df,
  "pre_region",
  into = c('pre_reg', 'reg'),
  sep = "_",
  remove = TRUE
)
df <- separate(
  df,
  "post_region",
  into = c('extra', 'post_reg'),
  sep = 5,
  remove = TRUE,
  convert = FALSE,
  extra = "warn",
  fill = "warn"
)

df <- separate(
  df,
  "post_reg",
  into = c('post_reg', 'reg'),
  sep = "_",
  remove = TRUE,
  convert = FALSE,
  extra = "warn",
  fill = "warn"
)

#delete extra columns
df %<>% select(-c(extra, reg,"change_vo2"))

#keep columns where pre and post match
df <- df[df$pre_reg == df$post_reg,]

#calculate changes 
df$vo2_ch <- df$PostVo2max - df$PreVo2max
df$active_ch <- df$post_active - df$pre_active

df_long <- df %>%
 pivot_longer(
   cols = c(pre_active, post_active),
   names_to = "pre_post",
   values_to = "active"
 )

```


# Change in VO$_2$ Max 
```{r, echo=FALSE, fig.height=3.1, fig.width=5, fig.align='center', fig.cap=" "}
p2 <- ggplot(df0) +
  aes(y = PostVo2max - PreVo2max, x = Group, color = Group) +
  geom_jitter(width = 0.1, size = 2) + 
  theme_minimal()+
  labs(title = expression(paste("Change in ", VO[2]," Max: Treatment and Control",sep="")))+
  ylab(expression(paste("Change in ", VO[2]," Max",sep="")))+
  scale_x_discrete(labels= c("Exercise", "Resistance"))+
  theme(legend.position = "none")+
  theme(text = element_text(size = text_size))   
p2
ggsave('Fig1.png', p2)
```

*Edits*  
The treatment group performed an aerobic/endurance exercise training program for 12 weeks (n=10). The control group performed a resistance training program for 12 weeks (n=5), since resistance training has been shown to not impact cardiopulmonary fitness.  
We can see the differing spreads in the treatment and control groups. The minimum and maximum change of VO$_2$ max in the control group is each more extreme than the minimum and maximum in the treatment group. In both groups, most participants have a positive change of max VO$_2$ (Figure 1).  

*Original*  
The control group performed a resistance training program for 12 weeks(N=5), since resistance training has been shown to not impact cardiopulmonary fitness. The treatment group performed an aerobic/endurance exercise training program for 12 weeks(N=10).
Based on the picture above, we can draw a conclusion that the change of Vo2Max between treatment group and control is different. The maximum change of Vo2Max in the control group is greater than the maximum change in the treatment group. And the minimum change of Vo2Max in the control group is less than the minimum change in the treatment group. In the treatment group, most of the change of Vo2Max is positive.

 

# Change in VO$_2$ Max, Fitness, and Brain Activation
*Edits*  
The abscissa of each point in the below figure shows the change of VO$_2$ max, and the y axis shows the change in brain region activation (Figure 2). The data are mainly distributed in the first and fourth quadrants. In the entorhinal, hippocampus and parahippocampal regions of the left and right brains, a small number of data in the control group and treatment group had a negative change in VO$_2$ max, and the rest are positive.  Based on the plot, there is not a statistically significant difference in the change of VO$_2$ max between the treatment and control groups since the range of VO$_2$ max in the control group is greater than that in the treatment group.   

*Original*  
```{r, fig.height=6.2, fig.width=10, fig.align='center', fig.cap=" "}
p1 <- ggplot(data = df, mapping = aes(x = vo2_ch, y = active_ch, colour = Group)) +
  geom_point(shape = "circle", size = 2L) +
  geom_hline(yintercept=0, colour = "grey")+
  geom_vline(xintercept=0, colour = "grey")+
  facet_wrap(vars(pre_reg))+
  labs(title = expression(paste("Change in ", VO[2]," Max and Brain Region Activation",sep="")))+
  ylab("Activation Change")+
  xlab("Fitness Change")+
  scale_color_discrete(name="Treatment Group",
                         breaks=c("ET", "RT"),
                         labels=c("Exercise", "Resistance"))+
  theme_minimal()+
  theme(text = element_text(size = text_size))   
ggsave('Fig2.png', p1)
p1
```

The abscissa of each point in the above figure shows the change of Vo2Max, and the data is mainly distributed in the first and fourth quadrants. In the entorhinal, hippocampus and parahippocampal regions of the left and right brains, a small number of data in the control group and treatment group had a negative change in Vo2Max, and the rest are positive. There is no significant difference in the change of Vo2Max between the treatment group and control group. The maximum change of Vo2Max in the control group is always greater than the maximum change of Vo2Max in the treatment group.



```{r, fig.height=5, fig.width=7.5, fig.align='center', fig.cap = " "}
p3 <- ggplot(df, aes(x = pre_active, y = post_active, colour = Group)) +
  geom_point(shape = "circle", size = 2L) +
  geom_hline(yintercept=0, colour = "grey")+
  geom_vline(xintercept=0, colour = "grey")+
  facet_wrap(vars(pre_reg)) +
  labs(title = "Pre and Post Treatment Activation")+
  xlab("Pre-Treatment Activation")+
  ylab("Post-Treatment Activation")+
  scale_color_discrete(name="Treatment Group",
                         breaks=c("ET", "RT"),
                         labels=c("Exercise", "Resistance"))+
  theme_minimal() +
  theme(text = element_text(size = text_size)) 
ggsave('Fig3.png', p3, height = 6, width = 10)
p3
```

Figure 3 shows change in brain region activation for each measured region. The x-axis shows the pre-treatment level of activation and the y-axis shows the post-treatment level for the same participant. If a point falls in the first or third quadrant, their activation remained either positive or negative for both readings, but if a point is in the second or fourth quadrant, the activation changed from either  
1. negative in the first reading to positive in the second reading or  
2. positive in the first reading to negative in the second reading.   
Each region shows a slightly different pattern of points, but no single plot stands out as having a distinct pattern. 


```{r, fig.height=6.2, fig.width=10, fig.align='center', fig.cap = ""}
#treatment group
#create data with treatment group
df_treat <- df_long[df_long$Group == "ET",]

#make density plot
t <- ggplot(df_treat,aes(x=active, fill =pre_post)) + geom_histogram(alpha=0.5, bins =6,position="identity")+
  xlim(-1,0.5)+
  scale_y_continuous(breaks=seq(0,10,by=2),limits = c(0,10))+
  facet_wrap(vars(pre_reg))+
  labs(title = "Treatment group region activation")+
  xlab("Activation")+
  ylab("Count")+
  theme(legend.position = "none")+
  theme_minimal()+
  theme(text = element_text(size = text_size)) 


#create data with control group
df_cont <- df_long[df_long$Group == "RT",]

#make density plot
c <- ggplot(df_cont,aes(x=active, fill =pre_post)) + geom_histogram(alpha=0.5, bins = 6,position="identity")+
  xlim(-1,0.5)+ 
  scale_y_continuous(breaks=seq(0,10,by=2),limits = c(0,10))+
  facet_wrap(vars(pre_reg))+ 
  labs(title = "Control group region activation")+
  xlab("Activation")+
  ylab("Count")+
  scale_fill_discrete(name="Measurement Time",
                         breaks=c("pre_active", "post_active"),
                         labels=c("Pre-Treatment", "Post-Treatment"))+
  theme_minimal()+
  theme(text = element_text(size = text_size)) 

   
#combine the figures
figure <- ggarrange(c, t,  ncol = 2, nrow = 1, align = "v",
                    common.legend = TRUE, legend="bottom")

figure

#save the figures
ggsave('Fig4.png', figure, height = 6.2, width = 10)
```

Figure 4 is a slightly different way to evaluate change in brain region activation. Instead of a scatterplot we have created a histogram. Since there is overlap between the bars, there is not a strong difference in pre and post treatment brain region level of activation.

# Conclusion 
*Edits*  
**Client Questions**    
1. Are there differences in brain region activation before and after the exercise intervention?  
2. Is there a correlation between fitness and brain region activation?  
3. Are there differences between the control group and the treatment group?
\newline
Based on the provided data, the exercise intervention leads to impacts of varying degrees depending on the individual. Based on our EDA, there is not a detectable linear relationship between fitness and brain region activation.The differences between control and treatment groups follow a similar pattern and we were not able to detect a significant difference. In future studies we would recommend a larger sample size. We would be happy to consult on suggested sample sizes for future projects. 

*Original*
According to clients’ questions, there are huge differences in brain activation before and after exercise intervention.The exercise intervention leads to impacts in varying degrees.  As for the control group, the hippocampus shows a small rise at peak, while the entorhinal and right parahippocampal shows large and positive fluctuations. Additionally, the peak of the left parahippocampal dramatically decreases. For the treatment group, most of the brain shows negative fluctuations except for the left hippocampus.   

***Do we have a line of code for this?***
***Based on the computational output, there is no linear relationship between fitness and brain region activation. The coefficients in the correlation test are small enough to show non statistically significance.***    

The differences between control and experimental groups are also significant. As is shown in the image, the group with aerobic/endurance exercises training program shows the opposite tendency and volatility. 



